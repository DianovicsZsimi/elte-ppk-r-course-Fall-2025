pivot_longer(
cols = all_of(x_cols),
names_to = "path",
values_to = "x"
)
# Visualize new model
ggplot(data_3_long, aes(x = x, y = y)) +
geom_point(shape = 21, fill = "white", color = "blue", size = 0.7) +
ylim(0, 200) +
xlim(400, 600) +
theme(panel.background = element_rect(fill = "black"),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.ticks = element_blank(),
axis.text = element_blank(),
panel.grid = element_blank())
# Animate the model
animation = ggplot(data_3_long, aes(x = x, y = y)) +
geom_point(shape = 21, fill = "white", color = "blue", size = 0.7) +
ylim(200, 0) +
xlim(400, 600) +
theme(panel.background = element_rect(fill = "black"),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.ticks = element_blank(),
axis.text = element_blank(),
panel.grid = element_blank()) +
transition_manual(frames = y, cumulative = TRUE)
animated_plot <- animate(animation, width = 500, height = 500,  res = 100, duration = 3, renderer = gifski_renderer())
animated_plot
animation = ggplot(data_3_long, aes(x = x, y = y)) +
geom_point(shape = 21, fill = "white", color = "blue", size = 0.7, stroke = 0.2) +
ylim(200, 0) +
xlim(400, 600) +
theme(panel.background = element_rect(fill = "black"),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.ticks = element_blank(),
axis.text = element_blank(),
panel.grid = element_blank()) +
transition_manual(frames = y, cumulative = TRUE)
animated_plot <- animate(animation, width = 500, height = 500,  res = 100, duration = 3, renderer = gifski_renderer())
animated_plot
n_steps <- 1000
fork_prob <- 0.01
data_3 <- tibble(y = 1, x = 500)
fork_count <- 0
bias_length <- 6
bias_value <- 1
bias_length_remaining <- c()
for(i in 1:n_steps) {
new_y <- data_3$y[nrow(data_3)] + 1
x_cols <- names(data_3)[str_detect(names(data_3), "^x")]
new_row <- tibble(y = new_y)
for(col in x_cols) {
if(col %in% names(bias_length_remaining)) {
new_row[[col]] <- data_3[[col]][nrow(data_3)] + bias_value
bias_length_remaining[[col]] <- bias_length_remaining[[col]] - 1
if(bias_length_remaining[[col]] == 0) {
bias_length_remaining <- bias_length_remaining[!names(bias_length_remaining) %in% col]
}
} else {
new_row[[col]] <- data_3[[col]][nrow(data_3)] + sample(c(-1, 1), 1)
}
}
for(col in x_cols) {
if(runif(1) < fork_prob) {
fork_count <- fork_count + 1
fork_col <- paste0("x_fork_", fork_count)
new_row[[fork_col]] <- new_row[[col]]
bias_length_remaining[[fork_col]] <- bias_length
}
}
data_3 <- bind_rows(data_3, new_row)
}
n_steps <- 400
fork_prob <- 0.01
data_3 <- tibble(y = 1, x = 500)
fork_count <- 0
bias_length <- 6
bias_value <- 1
bias_length_remaining <- c()
for(i in 1:n_steps) {
new_y <- data_3$y[nrow(data_3)] + 1
x_cols <- names(data_3)[str_detect(names(data_3), "^x")]
new_row <- tibble(y = new_y)
for(col in x_cols) {
if(col %in% names(bias_length_remaining)) {
new_row[[col]] <- data_3[[col]][nrow(data_3)] + bias_value
bias_length_remaining[[col]] <- bias_length_remaining[[col]] - 1
if(bias_length_remaining[[col]] == 0) {
bias_length_remaining <- bias_length_remaining[!names(bias_length_remaining) %in% col]
}
} else {
new_row[[col]] <- data_3[[col]][nrow(data_3)] + sample(c(-1, 1), 1)
}
}
for(col in x_cols) {
if(runif(1) < fork_prob) {
fork_count <- fork_count + 1
fork_col <- paste0("x_fork_", fork_count)
new_row[[fork_col]] <- new_row[[col]]
bias_length_remaining[[fork_col]] <- bias_length
}
}
data_3 <- bind_rows(data_3, new_row)
}
x_cols <- names(data_3)[str_detect(names(data_3), "^x")]
data_3_long <- data_3 %>%
pivot_longer(
cols = all_of(x_cols),
names_to = "path",
values_to = "x"
)
# Visualize new model
ggplot(data_3_long, aes(x = x, y = y)) +
geom_point(shape = 21, fill = "white", color = "blue", size = 0.7) +
ylim(0, 400) +
xlim(400, 600) +
theme(panel.background = element_rect(fill = "black"),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.ticks = element_blank(),
axis.text = element_blank(),
panel.grid = element_blank())
# Animate the model
animation = ggplot(data_3_long, aes(x = x, y = y)) +
geom_point(shape = 21, fill = "white", color = "blue", size = 0.7, stroke = 0.2) +
ylim(400, 0) +
xlim(400, 600) +
theme(panel.background = element_rect(fill = "black"),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.ticks = element_blank(),
axis.text = element_blank(),
panel.grid = element_blank()) +
transition_manual(frames = y, cumulative = TRUE)
animated_plot <- animate(animation, width = 500, height = 500,  res = 100, duration = 3, renderer = gifski_renderer())
animated_plot
n_steps <- 300
fork_prob <- 0.01
data_3 <- tibble(y = 1, x = 500)
fork_count <- 0
bias_length <- 6
bias_value <- 1
bias_length_remaining <- c()
for(i in 1:n_steps) {
new_y <- data_3$y[nrow(data_3)] + 1
x_cols <- names(data_3)[str_detect(names(data_3), "^x")]
new_row <- tibble(y = new_y)
for(col in x_cols) {
if(col %in% names(bias_length_remaining)) {
new_row[[col]] <- data_3[[col]][nrow(data_3)] + bias_value
bias_length_remaining[[col]] <- bias_length_remaining[[col]] - 1
if(bias_length_remaining[[col]] == 0) {
bias_length_remaining <- bias_length_remaining[!names(bias_length_remaining) %in% col]
}
} else {
new_row[[col]] <- data_3[[col]][nrow(data_3)] + sample(c(-1, 1), 1)
}
}
for(col in x_cols) {
if(runif(1) < fork_prob) {
fork_count <- fork_count + 1
fork_col <- paste0("x_fork_", fork_count)
new_row[[fork_col]] <- new_row[[col]]
bias_length_remaining[[fork_col]] <- bias_length
}
}
data_3 <- bind_rows(data_3, new_row)
}
x_cols <- names(data_3)[str_detect(names(data_3), "^x")]
data_3_long <- data_3 %>%
pivot_longer(
cols = all_of(x_cols),
names_to = "path",
values_to = "x"
)
# Visualize new model
ggplot(data_3_long, aes(x = x, y = y)) +
geom_point(shape = 21, fill = "white", color = "blue", size = 0.7) +
ylim(0, 300) +
xlim(400, 600) +
theme(panel.background = element_rect(fill = "black"),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.ticks = element_blank(),
axis.text = element_blank(),
panel.grid = element_blank())
# Animate the model
animation = ggplot(data_3_long, aes(x = x, y = y)) +
geom_point(shape = 21, fill = "white", color = "blue", size = 0.7, stroke = 0.2) +
ylim(300, 0) +
xlim(400, 600) +
theme(panel.background = element_rect(fill = "black"),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.ticks = element_blank(),
axis.text = element_blank(),
panel.grid = element_blank()) +
transition_manual(frames = y, cumulative = TRUE)
animated_plot <- animate(animation, width = 500, height = 500,  res = 100, duration = 3, renderer = gifski_renderer())
animated_plot
n_steps <- 300
fork_prob <- 0.01
data_3 <- tibble(y = 1, x = 500)
fork_count <- 0
bias_length <- 6
bias_value <- 1
bias_length_remaining <- c()
for(i in 1:n_steps) {
new_y <- data_3$y[nrow(data_3)] + 1
x_cols <- names(data_3)[str_detect(names(data_3), "^x")]
new_row <- tibble(y = new_y)
for(col in x_cols) {
if(col %in% names(bias_length_remaining)) {
new_row[[col]] <- data_3[[col]][nrow(data_3)] + bias_value
bias_length_remaining[[col]] <- bias_length_remaining[[col]] - 1
if(bias_length_remaining[[col]] == 0) {
bias_length_remaining <- bias_length_remaining[!names(bias_length_remaining) %in% col]
}
} else {
new_row[[col]] <- data_3[[col]][nrow(data_3)] + sample(c(-1, 1), 1)
}
}
for(col in x_cols) {
if(runif(1) < fork_prob) {
fork_count <- fork_count + 1
fork_col <- paste0("x_fork_", fork_count)
new_row[[fork_col]] <- new_row[[col]]
bias_length_remaining[[fork_col]] <- bias_length
}
}
data_3 <- bind_rows(data_3, new_row)
}
x_cols <- names(data_3)[str_detect(names(data_3), "^x")]
data_3_long <- data_3 %>%
pivot_longer(
cols = all_of(x_cols),
names_to = "path",
values_to = "x"
)
# Visualize new model
ggplot(data_3_long, aes(x = x, y = y)) +
geom_point(shape = 21, fill = "white", color = "blue", size = 0.7) +
ylim(0, 300) +
xlim(400, 600) +
theme(panel.background = element_rect(fill = "black"),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.ticks = element_blank(),
axis.text = element_blank(),
panel.grid = element_blank())
# Animate the model
animation = ggplot(data_3_long, aes(x = x, y = y)) +
geom_point(shape = 21, fill = "white", color = "blue", size = 0.7, stroke = 0.2) +
ylim(300, 0) +
xlim(400, 600) +
theme(panel.background = element_rect(fill = "black"),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.ticks = element_blank(),
axis.text = element_blank(),
panel.grid = element_blank()) +
transition_manual(frames = y, cumulative = TRUE)
animated_plot <- animate(animation, width = 500, height = 500,  res = 100, duration = 3, renderer = gifski_renderer())
animated_plot
# Chunk 1: setup
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(here)
library(patchwork)
here::here()
# Chunk 2
library(ggplot2)
library(dplyr)
library(patchwork)
library(corrplot)
library(psych)
library(MVN)
data  = read.csv(here::here("data/assignment_5_dataset.csv"))
# Chunk 3
head(data)
summary(data)
# Based on the article, the following items are reverse-scored: 16, 19, 21, 24, 28
data = data |>
mutate(
ar16 = 6 - ar16,
ar19 = 6 - ar19,
ar21 = 6 - ar21,
ar24 = 6 - ar24,
ar28 = 6 - ar28
)
items <- paste0("ar", 1:28)
plots <- list()
for (item in items) {
p <- data %>%
ggplot(aes(x = as.numeric(.data[[item]]))) +
geom_histogram(binwidth = 1, boundary = 0.5, closed = "right") +
scale_x_continuous(
breaks = 1:5,
limits = c(0.5, 5.5)
) +
labs(
title = NULL,
x = item,
y = NULL
) +
theme_minimal(base_size = 10) +
theme(
axis.text.y = element_blank(),
axis.ticks.y = element_blank(),
panel.grid.major.y = element_blank(),
panel.grid.minor = element_blank()
)
plots[[item]] <- p
}
wrap_plots(plots, ncol = 4)
participant_summary <- data %>%
rowwise() %>%
select(ar1:ar28) %>%
summarise(
mean_row = mean(c_across(everything()), na.rm = TRUE),
sum_row  = sum(c_across(starts_with("ar")), na.rm = TRUE),
median_row = median(c_across(where(is.numeric)), na.rm = TRUE),
sd_row = sd(c_across(where(is.numeric)), na.rm = TRUE)
) %>%
ungroup()
# Chunk 4
# Removing rows with NA values for ease of analysis (multiple imputation can be done, but losing four cases is acceptable here)
data = data |>
rowwise() |>
filter(if_all(everything(), ~ !is.na(.)))
data = data |>
mutate(sex = factor(sex, levels = c(1,2), labels = c("male", "female")),
party = factor(party, levels = c(1,2,3,4), labels = c("democrat", "republican", "other", "none"))
)
# Chunk 5
correlation_data = data |>
select(ar1:ar28)
# Chunk 6
cor_matrix = cor(correlation_data, use = "pairwise.complete.obs")
# Chunk 7
corrplot(cor_matrix, method = "color", type = "lower", tl.col = "black", tl.srt = 45)
# Chunk 8
kmo_result = KMO(cor_matrix)
kmo_result
# Question 18 and 28 have below .80 MSA values, consider removing them later if necessary.
# Bartlett's test
bartlett_result = cortest.bartlett(cor_matrix, n = nrow(correlation_data))
bartlett_result
# Chunk 9
mvn_result = MVN::mvn(data = correlation_data, mvn_test = "mardia",
univariate_test = "SW",
#multivariatePlot = "qq"
)
mvn_result
# Chunk 10
skew_kurtosis_data = data.frame(
item = rownames(mvn_result$descriptives),
skewness = mvn_result$descriptives$Skew,
kurtosis = mvn_result$descriptives$Kurtosis
) |>
mutate(
skewness = if_else(abs(skewness) > 2, "skewed" , "normal" ),
kurtosis = if_else(abs(kurtosis) > 7, "kurt", "normal")
)
skew_kurtosis_data
# Chunk 11
# Remove rows with NA values for prcomp
correlation_data = na.omit(correlation_data)
# Remove subpar questions
correlation_data = correlation_data |>
select(-ar18, -ar28)
pca = prcomp(correlation_data, scale. = TRUE)
eigen_values = pca$sdev^2
plot(eigen_values, type = "b", xlab = "Component Number", ylab = "Eigenvalue", main = "Scree Plot")
abline(v = 2, col = "red")
plot(eigen_values/sum(eigen_values), type = "b",
xlab = "Principal Component",
ylab = "Percentage of Variance Explained")
abline(v = 2, col = "red")
# It seems that 2 factors is a reasonable choice based on the scree plot.
# Chunk 12
efa_result = fa(correlation_data,
nfactors = 2,
rotate = "oblimin",
fm = "pa")
efa_result$loadings
# There is significant cross-loading
# Several items do no reach the 0.3 threshold
# Chunk 13
efa_communality = as.data.frame(efa_result$communality[order(-efa_result$communality)])
colnames(efa_communality) = c("Communality")
efa_communality
# Chunk 14
mean_communality = mean(efa_result$communality)
mean_communality
# Chunk 15
loadings_df = as.data.frame(efa_result$loadings[1:nrow(efa_result$loadings), 1:ncol(efa_result$loadings)])
colnames(loadings_df) = c("Factor 1", "Factor 2")
loadings_df = loadings_df |>
mutate(across(everything(), ~ round(.x, 3)),
factor_1 = if_else(abs(`Factor 1`) < 0.2, NA, `Factor 1`),
factor_2 = if_else(abs(`Factor 2`) < 0.2, NA, `Factor 2`)) |>
select(factor_1, factor_2)
loadings_df
# Cronbach alpha
items_factor1 <- names(which(abs(efa_result$loadings[,1]) > 0.3))
alpha(correlation_data[, items_factor1])
items_factor2 <- names(which(abs(efa_result$loadings[,2]) > 0.3))
alpha(correlation_data[, items_factor2])
# Cronbach alpha is acceptable for both factors
# Model fit
efa_result
# RMSEA is fine, TLI is a bit low but acceptable, overall, fit should be improved
# Items 14, 11, 8, 1 do not load significantly at the 0.3 threshold on any factor, I will remove them and redo the analysis
## Redo factor analysis without low-loading items
correlation_data_new = correlation_data |>
select(-ar1, -ar8, -ar11, -ar14)
efa_result_new = fa(correlation_data_new,
nfactors = 2,
rotate = "oblimin",
fm = "pa")
efa_result_new$loadings
# Compare models
model_comparison <- data.frame(
Model = c("Initial", "Revised"),
Chi_Square = c(efa_result$STATISTIC, efa_result_new$STATISTIC),
RMSEA = c(efa_result$RMSEA[1], efa_result_new$RMSEA[1]),
TLI = c(efa_result$TLI, efa_result_new$TLI),
BIC = c(efa_result$BIC, efa_result_new$BIC)
) |>
mutate(
Chi_Square = round(Chi_Square, 3),
RMSEA = round(RMSEA, 3),
TLI = round(TLI, 3),
BIC = round(BIC, 3)
)
model_comparison
# The revised model shows improved fit indices, I will proceed with this model.
# Chunk 16
fa.diagram(efa_result_new)
# Chunk 17
efa_result_new$loadings
# Factor 1 contains these items: 3,4, 5, 7, 10, 13, 15, 16, 22, 23, 24, 26
# Item 15 cross-loads but loads higher on factor 1, I will include it there.
# Factor 2 contains these items: 2, 6, 9, 12, 17, 19, 20, 21, 25, 27
# Item 12 cross-loads but loads higher on factor 2, I will include it there as well.
# Calculate factor scores
factor_scores = correlation_data_new |>
mutate(
factor_1_total = ar3 + ar4 + ar5 + ar7 + ar10 + ar13 + ar15 + ar16 + ar22 + ar23 + ar24 + ar26,
factor_2_total = ar2 + ar6 + ar9 + ar12 + ar17+ ar19 + ar20 + ar21 + ar25 + ar27
) |>
select(factor_1_total, factor_2_total)
# Factor 1 items
# It is morally wrong to drink milk and eat eggs.
# A human has no right to use a horse as a means of transportation (riding) or entertainment (racing).
# It is wrong to wear leather jackets and pants.
# I have seriously considered becoming a vegetarian in an effort to save animal lives.
# It is morally wrong to eat beef and other "red" meat.
# It is wrong to wear leather belts and shoes.
# Having extended basic rights to minorities and women, it is now time to extend them also to animals.
# God put animals on Earth for man to use.
# It is a violation of an animal's rights to be held captive as a pet by a
# It is wrong to wear animal fur (such as mink coats).
# It is appropriate for humans to kill animals that destroy human property, for example, rats, mice, and pigeons.
# It is morally wrong to eat chicken and fish.
# Hunters play an important role in regulating the size of deer populations.
# Factor 2 items
# Animal research cannot be justified and should be stopped.
# Most medical research done on animals is unnecessary and invalid.
# We need more regulations governing the use of animals in research.
# Animals should be granted the same rights as humans.
# There are plenty of viable alternatives to the use of animals in biomedical and behavioral research.
# Research on animals has little or no bearing on problems confronting people.
# New surgical procedures and experimental drugs should be tested on animals before they are used on people.
# I am very concerned about pain and suffering in animals.
# Since many important questions cannot be answered by doing experiments on people, we are left with no alternatives but to do animal research.
# Most cosmetics research done on animals is unnecessary and invalid.
# Most psychological research done on animals is unnecessary and invalid.
# Factor 1 can be called: wrongful use of animals
# Factor 2 can be called: animal research ethics
factor_scores = factor_scores |>
rename(
wrongful_use_of_animals = factor_1_total,
animal_research_ethics = factor_2_total
)
# Chunk 18
data_regression <- data |>
bind_cols(factor_scores)
# Chunk 19
regression_model = lm(liberal ~ wrongful_use_of_animals + animal_research_ethics, data = data_regression)
summary(regression_model)
# Model performance is weak, R2 is low.
# Almost everyone is predicted to be around 3 (no strong opinion), which is strange.
# If we alter scores based on party affiliation, so that democrats get +1, republicans -1, if they answered with a 3, the model might be better
data_regression_qrp = data_regression |>
mutate(liberal_qrp = case_when(
party == "democrat" & liberal == 3 ~ 4,
party == "republican" & liberal == 3 ~ 2,
TRUE ~ liberal
))
regression_questionable = lm(liberal_qrp ~ wrongful_use_of_animals + animal_research_ethics, data = data_regression_qrp)
summary(regression_questionable)
# The model has not improved significantly, R2 is still low, now no factors are significant.
regression_model = lm(liberal ~ wrongful_use_of_animals + animal_research_ethics, data = data_regression)
summary(regression_model)
efa_communality_new = as.data.frame(efa_result_new$communality[order(-efa_result_new$communality)])
colnames(efa_communality_new) = c("Communality")
efa_communality_new
